<?phpnamespace app\admin\controller;use think\Controller;use think\Db;class Category extends Controller{    public function _initialize()    {   //先调用一下,验证权限        parent::_initialize();        checkToken();    }    public function add()    {        //1.权限验证        if (!$this->request->isPost()) {            return json([                'code' => 404,                'msg' => '请求方式错误！'            ]);        }        $data = $this->request->post();        $validate = validate('Category');        if (!$validate->check($data)) {            return json([                'code' => 404,                'msg' => $validate->getError()            ]);        }        $result = Db::table('category')->insert($data);        if ($result) {            return json([                'code' => 200,                'msg' => '分类添加成功'            ]);        } else {            return json([                'code' => 404,                'msg' => "分类添加失败"            ]);        }    }    /*     * 1.查看数据     * 2.分页、搜索     * 3.前台:符合指定条件的某些若干个数据     * 4.后台:当前页面数据返回,返回数据总数     * */    public function showCategory()    {        //前端数据接受        $data = $this->request->post();        //判断是否传过来分页信息        if (isset($data['page']) && !empty($data['page'])) {            $page = $data['page'];        } else {            $page = 1;        }        if (isset($data['limit']) && !empty($data['limit'])) {            $limit = $data['limit'];        } else {            $limit = 5;        }        $where = [];        if (isset($data['cname']) && !empty($data['cname'])) {            $where['cname'] = ['like', '%' . $data['cname'] . '%'];        }        $category = Db::table('category')->field('cid,cname,cdesc')->where($where)->page($page)->limit($limit)->select();        $count = Db::table('category')->where($where)->count();        if ($category && $count) {            return json([                'code' => 200,                'msg' => '数据获取成功',                'data' => $category,                'total' => $count            ]);        } else {            return json([                'code' => 200,                'msg' => '暂无数据'            ]);        }    }    public function showCategoryAll()    {        //前端数据接受        //判断是否传过来分页信息        $category = Db::table('category')->field('cid,cname')->select();        if ($category) {            return json([                'code' => 200,                'msg' => '分类数据加载成功',                'data' => $category            ]);        } else {            return json([                'code' => 404,                'msg' => '数据加载失败'            ]);        }    }    public function delCategory(){        if (!$this->request->isPost()) {            return json([                'code' => 404,                'msg' => '请求方式错误！'            ]);        }        $data = $this->request->post();        $cid = $data['cid'];        //var_dump($data);        $a = Db::table('category')->where('cid','=',$cid)->delete();        if($a){            return json([                'code' => 200,                'msg' => '数据删除成功',            ]);        }else{            return json([                'code' => 404,                'msg' => '数据删除失败',            ]);        }    }    public function editCategory(){        if(!$this->request->isPost()){            return json([                'code'=>404,                'msg'=>'请求方式不对'            ]);        }        $data = $this->request->post();        $cid = $data['cid'];        $cname = $data['cname'];        $cdesc = $data['cdesc'];        //var_dump($data);        $a = Db::table('category')->where('cid','=',$cid)->update(['cname'=>$cname,'cdesc'=>$cdesc]);        if($a){            return json([                'code'=>200,                'msg'=>'数据更新成功！'            ]);        }else{            return json([                'code'=>404,                'msg'=>'数据更新失败！'            ]);        }    }}